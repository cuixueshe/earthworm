<template>
  <div class="container w-full">
    <template v-if="isLoading">
      <Loading></Loading>
    </template>
    <template v-else>
      <section class="flex items-center flex-col py-8 mx-4">
          <div class="mb-12 leading-loose text-3xl opacity-80 items-center">
            <div class="">Why arenâ€™t you good at English?</div>
            <div class="align-middle">
              Itâ€™s because you havenâ€™t used
              <span class="text-fuchsia-400 font-bold">EARTHWORM</span> yet! ğŸ¤ª
              <i class="animate-wink inline w-1 h-8 dark:bg-white bg-slate-900 mx-2 text-2xl p-[2px]"></i>
            </div>
          </div>
          <a class="mb-4" target="_blank" href="https://github.com/cuixueshe/earthworm">
            <button class="btn w-48 indicator">
              <span class="indicator-item">ğŸŒŸ</span>
              Star us on GitHub
            </button>
          </a>
          <button @click="handleStart"
            class="btn btn-outline w-48 hover:text-fuchsia-400 hover:border-fuchsia-400 hover:bg-fuchsia-100 text-fuchsia-300 border-fuchsia-300">
            Get Started
          </button>

      </section>
      <section class="flex flex-col py-8">
        <h2 class="text-4xl text-center">What is Earthworm?</h2>
        <p class="text-center pt-5 color-[#666]">
          an open-source, collaborative, user-friendly English learning tool.
        </p>
        <div
          class="rounded-3xl my-8 mx-2 border dark:border-slate-600 bg-gradient-to-b from-neutral-50/90 to-neutral-100/90 transition duration-300 dark:from-neutral-600/90 dark:to-neutral-450/90 hover:shadow-2xl">
          <div class=" flex flex-col p-4 text-sm">
            <h2 class="text-xl font-bold py-4">å¿«é€Ÿä¸Šæ‰‹</h2>
            <p class="py-1">
              å½“å‰é¡µé¢ï¼Œç‚¹å‡»æŒ‰é’®
              <span class="inline-block px-1 text-fuchsia-300 border border-solid border-fuchsia-300 rounded-lg">Get
                Started</span>ï¼Œå¼€å¯ä½ çš„ç¬¬ä¸€èŠ‚è¯¾ã€‚
            </p>
            <p class="py-1">
              è¯¾ç¨‹é¡µé¢ï¼Œç´«è‰²ä¸‹åˆ’çº¿ä¸ºèšç„¦çŠ¶æ€ï¼Œè¾“å…¥ä½ çš„ç­”æ¡ˆï¼Œç‚¹å‡»<span class="inline-block px-1 text-fuchsia-300 border border-solid border-fuchsia-300 rounded-lg mx-1">Submit</span>éªŒè¯ç»“æœã€‚
            </p>
            <p class="py-1">éªŒè¯é€šè¿‡æ‰ä¼šæ˜¾ç¤ºæ­£ç¡®ç»“æœï¼Œå¹¶è¯­éŸ³æ’­æŠ¥ã€‚</p>
            <p class="py-1">
              ç‚¹å‡»æŒ‰é’®
              <button class="instruction-btn">again</button>é‡ç½®æ­¤å‰æ“ä½œï¼Œå†æ¥äº¿æ¬¡æ€èƒ½å­¦ä¸ä¼šã€‚
            </p>
            <p class="py-1">
              ç‚¹å‡»æŒ‰é’®
              <button class="instruction-btn">next</button>
              å¼€å§‹ä¸‹ä¸€ä¸ªï¼Œå†²å†²å†²éœ¸å æ¦œé¦–ã€‚
            </p>

            <h2 class="text-xl font-bold py-4">å¸®åŠ©</h2>
            <p class="py-1">
              è¯¾ç¨‹é¡µé¢ï¼Œè¾“å…¥ä¸‹åˆ’çº¿ä¸æ˜¯
              <span class="text-fuchsia-300">ç´«è‰²</span>
              æ—¶æ— æ³•è¾“å…¥ã€‚
            </p>
            <p class="py-1">æƒ³è¦è·å–æç¤ºï¼š</p>
            <p class="p-1">
              1. å¯ä»¥ç‚¹å‡»é¡µé¢ä¸‹æ–¹çš„è¯­éŸ³æ’­æ”¾æŒ‰é’®æ’­æ”¾è¯­éŸ³ã€‚
            </p>
            <p class="p-1">
              2. ä¹Ÿå¯ä»¥ç‚¹å‡»æ˜¾ç¤ºç­”æ¡ˆæŒ‰é’®æ˜¾ç¤ºç­”æ¡ˆã€‚
            </p>
            <p class="py-1">
              Earthwormæ›´æ³¨é‡äºæä¾›ä¼˜è´¨çš„PCç«¯ä½“éªŒï¼Œå¦‚æœæ¡ä»¶æ”¯æŒï¼Œè¯·ä½¿ç”¨PCè®¾å¤‡è¿›è¡Œå­¦ä¹ ã€‚æ‰‹æœºä¸Šåªæ”¯æŒéƒ¨åˆ†åŠŸèƒ½ï¼Œæ„Ÿè°¢ï¼
              <i class="animate-wink inline w-1 h-8 dark:bg-white bg-slate-900 mx-2 text-sm p-[2px]"></i>
            </p>
          </div>
        </div>
        <div class="w-1/2"></div>
        <div class="w-1/2"></div>
      </section>
    </template>
  </div>
</template>

<script setup lang="ts">
import Loading from "~/components/Loading.vue";
import { ref } from "vue";
import { useRouter } from "vue-router";
import { isMobileSystem } from "~/utils/system";
import { useGameStore } from "~/store/game";
import { useUserStore } from "~/store/user";

const userStore = useUserStore();
const { handleStart, isLoading } = useShortcutToGame();
const gameStore = useGameStore();

useMonitorSystem();

function useMonitorSystem() {
  const router = useRouter()

  if(!isMobileSystem()) {
    router.push('/')
  }
}

function useShortcutToGame() {
  const router = useRouter();
  const isLoading = ref(false);

  async function handleStart() {
    if(!userStore.user) {
      router.push('/auth/login')
      return
    }
    isLoading.value = true;
    const { courseId } = await gameStore.startGame();
    isLoading.value = false;
    router.push(`/main/${courseId}`);
  }



  return {
    handleStart,
    isLoading,
  };
}
</script>

<style>
.bg-dot {
  aspect-ratio: 1;
  position: relative;
  background: #fff;
  filter: contrast(50) invert(0);
  mix-blend-mode: multiply;
  isolation: isolate;
  opacity: 0.4;
  overflow: hidden;
}

.dark .bg-dot {
  opacity: 1;
}

.bg-dot::after {
  content: "";
  position: absolute;
  inset: 0;
  background-image: radial-gradient(circle at center,
      #a800b2 0.06rem,
      transparent 0.65rem);
  background-size: var(--bgSize, 1rem) var(--bgSize, 1rem);
  background-repeat: round;
  background-position:
    0 0,
    var(--bgPosition) var(--bgPosition);
  mask-image: linear-gradient(rgb(0 0 0), rgb(0 0 0 / 0.5));
}

.instruction-btn {
  @apply btn btn-xs text-gray-500 bg-gray-100 hover:text-gray-100 hover:bg-gray-500 dark:text-white dark:bg-gray-500 dark:hover:text-white dark:hover:bg-fuchsia-500;
}
</style>
