<template>
  <div class="container w-full">
    <template v-if="isLoading">
      <Loading></Loading>
    </template>

    <template v-else>
      <section class="w-full">
        <div
          class="bg-purple-200 dark:bg-gray-800 px-4 py-3 text-white sm:flex sm:items-center sm:justify-between sm:px-6 lg:px-8 rounded-lg"
        >
          <p
            class="text-center font-medium sm:text-left text-black dark:text-white"
          >
            Earthworm is now available! ğŸ‰
            <br class="sm:hidden" />
            Start your English learning journey now!
          </p>
          <a
            class="mt-4 block rounded-lg bg-white px-5 py-3 text-center text-sm font-medium text-purple-600 transition hover:bg-white/90 hover:text-pink-500 focus:outline-none focus:ring active:text-pink-500 sm:mt-0"
            href="https://github.com/cuixueshe/earthworm"
          >
            Learn More
          </a>
        </div>
      </section>
      <section
        class="flex flex-col justify-center py-8 md:flex-row md:justify-between"
      >
        <div class="w-1/2 mx-4">
          <div class="items-center mb-12 text-3xl leading-loose opacity-80">
            <div class="">Why arenâ€™t you good at English?</div>
            <div class="align-middle">
              Itâ€™s because you havenâ€™t used
              <span class="font-bold text-fuchsia-400">EARTHWORM</span> yet! ğŸ¤ª
              <i
                class="animate-wink inline w-1 h-8 dark:bg-white bg-slate-900 mx-2 text-2xl p-[2px]"
              ></i>
            </div>
          </div>
          <a
            class="w-48 mr-4 btn indicator"
            target="_blank"
            href="https://github.com/cuixueshe/earthworm"
          >
            <span class="indicator-item">ğŸŒŸ</span>
            Star us on GitHub
          </a>
          <button
            @click="handleKeydown"
            class="w-48 btn btn-outline hover:text-fuchsia-400 hover:border-fuchsia-400 hover:bg-fuchsia-100 text-fuchsia-300 border-fuchsia-300"
          >
            Get Started<kbd class="kbd"> â†µ </kbd>
          </button>
        </div>
        <div
          class="relative flex items-center justify-center w-1/2 m-4 cursor-pointer select-none group rounded-xl"
        >
          <div class="absolute flex w-full h-full card">
            <div class="bg-dot rounded-[64px]"></div>
            <div
              class="absolute left-0 right-0 top-0 text-[220px] text-center group-hover:-skew-y-12 group-hover:rotate-12 transition-all"
            >
              ğŸ“–
            </div>
            <!-- <div
              class="absolute left-48 right-0 top-24 text-[80px] -ml-28 text-center color-gray group-hover:-skew-y-12 group-hover:rotate-[30deg] group-hover:-ml-32 group-hover:-mt-6 transition-all">
              ğŸª±
            </div> -->
          </div>
        </div>
      </section>
      <section class="flex flex-col py-8">
        <h2 class="text-4xl text-center">What is Earthworm?</h2>
        <p class="pt-2 text-center">
          an open-source, collaborative, user-friendly English learning tool.
        </p>
        <div class="flex">
          <div
            class="w-1/2 mx-2 my-8 transition duration-300 border rounded-3xl dark:border-slate-600 bg-gradient-to-b from-neutral-50/90 to-neutral-100/90 dark:from-neutral-600/90 dark:to-neutral-450/90 hover:shadow-2xl"
          >
            <div class="h-[360px] flex flex-col pt-4 pl-4 pb-4 text-sm">
              <div class="pr-2 overflow-x-hidden overflow-y-auto">
                <h2 class="py-4 text-xl font-bold">å¿«é€Ÿä¸Šæ‰‹</h2>
                <h3 class="pb-2 text-base font-semibold">å½“å‰é¡µé¢</h3>
                <p class="py-1">
                  ç‚¹å‡»æŒ‰é’®
                  <span
                    class="inline-block px-1 mx-1 border border-solid rounded-lg text-fuchsia-300 border-fuchsia-300"
                    >Get Started</span
                  >
                  <span class="text-gray-500">ï¼ˆæˆ–å¿«æ·é”® Enter âï¼‰</span>
                  å¼€å¯ä½ çš„ç¬¬ä¸€èŠ‚è¯¾ï¼
                </p>
                <h3 class="py-2 text-base font-semibold">ç­”é¢˜é¡µé¢</h3>
                <p class="py-1 leading-7">
                  çœ‹åˆ°
                  <span class="text-fuchsia-500">ç´«è‰²ä¸‹åˆ’çº¿</span>
                  äº®èµ·ï¼Œè¾“å…¥å•è¯ï¼ŒæŒ‰ä¸‹ç©ºæ ¼é”®
                  <span class="text-gray-500">ï¼ˆSpace â£ï¼‰</span>
                  å‘ååˆ‡æ¢å•è¯ï¼Œå¾…è¾“å…¥å®Œæˆåå†æŒ‰ä¸‹å›è½¦é”®
                  <span class="text-gray-500">ï¼ˆEnter âï¼‰</span>
                  æ¥æäº¤é¢˜ç›®
                </p>
                <p class="py-1 leading-7">
                  é¢˜ç›®æäº¤åè‹¥å‡ºç°
                  <span class="text-red-500">çº¢è‰²</span>
                  å•è¯å’Œä¸‹åˆ’çº¿æ˜¾ç¤ºï¼Œä»£è¡¨è¿™éƒ¨åˆ†å•è¯å­˜åœ¨æŸäº›é”™è¯¯éœ€è¦æ›´æ­£ï¼Œæ­¤æ—¶å¯æŒ‰ä¸‹ç©ºæ ¼é”®
                  <span class="text-gray-500">ï¼ˆSpace â£ï¼‰</span>
                  å¿«é€Ÿå®šä½åˆ°ç¬¬ä¸€ä¸ªé”™è¯¯å•è¯å¹¶æ¸…ç©ºï¼Œå®Œæˆæ›´æ”¹åå†æŒ‰ä¸€æ¬¡ç©ºæ ¼ç»§ç»­å®šä½åˆ°ä¸‹ä¸ªé”™è¯
                </p>
                <p class="py-1 leading-7">
                  æ­¤æ—¶è‹¥å‘ç°ä¸Šä¸ªé”™è¯æœªæ­£ç¡®ä¿®æ”¹ï¼Œå¯æŒ‰ä¸‹é€€æ ¼é”®
                  <span class="text-gray-500">ï¼ˆBackspace âŒ«ï¼‰</span>
                  æ¥å›é€€åˆ°ä¸Šä¸€ä¸ªé”™è¯ï¼Œç›´åˆ°æ‰€æœ‰é”™è¯è¢«æ›´æ­£å®Œæˆï¼ŒæŒ‰ä¸‹å›è½¦é”®æäº¤å³å¯
                </p>
                <p class="py-1 leading-7">
                  éªŒè¯é€šè¿‡åä¼šæ˜¾ç¤ºç­”æ¡ˆé¡µé¢ï¼ŒåŒæ—¶ä¼šæ’­æ”¾å¯¹åº”é¢˜ç›®è¯­éŸ³ç”¨äºè¾…åŠ©è®°å¿†ã€‚
                </p>
                <h3 class="py-2 text-base font-semibold">ç­”é¢˜å°æŠ€å·§</h3>
                <p class="py-1 leading-7">
                  åº•éƒ¨æç¤ºé¢æ¿çš„æŒ‰é’®
                  <a
                    class="ml-1 text-[#3498db] hover:text-fuchsia-500"
                    href="https://www.bilibili.com/video/BV1py421q7Mp/"
                  >
                    ğŸ‘‰ ä¸€åˆ†é’Ÿç‚¹æˆ‘å¿«é€Ÿäº†è§£</a
                  >
                </p>
                <p class="p-1">
                  <button class="instruction-btn">âŒƒ Ctrl+'</button>
                  <span class="text-gray-500">ï¼ˆæˆ–å¿«æ·é”® Ctrl+'ï¼‰</span>
                  æ’­æ”¾é¢˜ç›®è¯­éŸ³
                </p>
                <p class="p-1">
                  <button class="instruction-btn">âŒƒ Ctrl+;</button>
                  <span class="text-gray-500">ï¼ˆæˆ–å¿«æ·é”® Ctrl+;ï¼‰</span>
                  æ˜¾ç¤ºé¢˜ç›®ç­”æ¡ˆ
                </p>
                <h3 class="py-2 text-base font-semibold">ç­”æ¡ˆé¡µé¢</h3>
                <p class="py-1 leading-7">ç­”æ¡ˆä¸‹æ–¹çš„æŒ‰é’®</p>
                <p class="py-1">
                  <button class="instruction-btn">again</button>
                  <span class="text-gray-500">ï¼ˆæˆ–å¿«æ·é”® Ctrl+;ï¼‰</span>
                  å†æ¥äº¿æ¬¡ï¼Œæ€èƒ½ä¸ä¼šï¼
                </p>
                <p class="py-1">
                  <button class="instruction-btn">next</button>
                  <span class="text-gray-500">ï¼ˆæˆ–å¿«æ·é”® Enterï¼‰</span>
                  ä¸‹ä¸€é¢˜ï¼Œå†²å†²å†²éœ¸å æ¦œé¦–ï¼ğŸ„â€â™‚ï¸
                </p>

                <h2 class="py-4 text-xl font-bold">å¸®åŠ©</h2>
                <h3 class="pb-2 text-base font-semibold">è¯¾ç¨‹é¡µé¢</h3>
                <p class="py-1 leading-7">
                  è¾“å…¥ä¸‹åˆ’çº¿å…¨æ˜¯ç°è‰²ï¼Œæ²¡æœ‰
                  <span class="text-fuchsia-500">ç´«è‰²</span>
                  äº®èµ·æ—¶æ— æ³•è¾“å…¥ï¼Œéœ€è¦ä½ åŠ¨åŠ¨å°æ‰‹ç§»åŠ¨é¼ æ ‡ç‚¹å‡»è¾“å…¥æ¡†è¿›è¡Œèšç„¦å“¦~
                </p>
                <h3 class="py-2 text-base font-semibold">ç”¨æˆ·è®¾ç½®é¡µé¢</h3>
                <p class="py-1 leading-7">
                  å³ä¸Šè§’å›¾æ ‡è¿›å…¥ User Info
                  åˆ‡æ¢åˆ°è®¾ç½®é¡µé¢ï¼Œè‡ªå®šä¹‰ä½ å–œæ¬¢çš„å¿«æ·é”®ï¼Œä¹Ÿå¯ä»¥æ§åˆ¶è¯­éŸ³æ˜¯å¦è‡ªåŠ¨æ’­æ”¾ã€å•è¯ä¸‹åˆ’çº¿å›ºå®šé•¿åº¦ã€ä½¿ç”¨ç©ºæ ¼æäº¤ç­‰ç­‰â€¦â€¦æ›´å¤šä¸ªäººè®¾ç½®ä¼šæŒç»­æ›´æ–°
                  ğŸ˜Š
                  <i
                    class="animate-wink inline w-1 h-8 dark:bg-white bg-slate-900 mx-2 text-sm p-[2px]"
                  ></i>
                </p>
              </div>
            </div>
          </div>
          <div
            class="w-1/2 mx-2 my-8 transition duration-300 border rounded-3xl dark:border-slate-600 bg-gradient-to-b from-neutral-50/90 to-neutral-100/90 dark:from-neutral-600/90 dark:to-neutral-450/90 hover:shadow-xl"
          >
            <div class="h-[360px] flex flex-col pt-4 pl-4 pb-4 text-sm">
              <div class="pr-2 overflow-x-hidden overflow-y-auto">
                <h2 class="py-4 text-xl font-bold">
                  å­¦ä¹ åŸç†ï¼šé€šè¿‡è¿è¯é€ å¥çš„æ–¹æ³•æ¥ç»ƒä¹ è‹±è¯­ ğŸ˜„
                </h2>
                <h3 class="pb-2 text-base font-semibold">ä»¥å¥å­ä¸ºæ ¸å¿ƒ</h3>
                <p class="py-1">
                  æ¯ä¸ªå¥å­åŒ…å«å•è¯/è¯ç»„/è¯­æ³•ï¼Œæ‰€ä»¥å­¦ä¼šä¸€ä¸ªå¥å­åï¼Œå°±å¯ä»¥æ¸…æ™°åœ°è¡¨è¾¾å‡ºæ¥ã€‚
                </p>
                <h3 class="py-2 text-base font-semibold">ä»»åŠ¡æ‹†åˆ†</h3>
                <p class="py-1 leading-7">
                  å°†ä¸€ä¸ªé•¿éš¾å¥æ‹†åˆ†æˆä¸€ä¸ªä¸ªçš„å°å•å…ƒï¼ˆå•è¯/è¯ç»„ï¼‰
                </p>
                <h3 class="py-2 text-base font-semibold">é‡å¤</h3>
                <p class="py-1 leading-7">é€šè¿‡ä¸æ–­åœ°é‡å¤æ¥å½¢æˆè‚Œè‚‰è®°å¿†</p>
                <h3 class="py-2 text-base font-semibold">i+1</h3>
                <p class="py-1 leading-7">
                  å¾ªåºæ¸è¿›çš„å¢åŠ éš¾åº¦ï¼Œå…ˆä»æœ€ç®€å•çš„å¥å‹å¼€å§‹ï¼Œå†åˆ°æ›´åŠ ä¸°å¯Œçš„æ¦‚å¿µ
                </p>
                <h3 class="pb-2 text-base font-semibold">æ­£å‘åé¦ˆæ¥çš„å¿«</h3>
                <p class="py-1 leading-7">
                  å½“è‡ªå·±å¯ä»¥å†™å‡ºé•¿éš¾å¥æ—¶ï¼Œä¼šéå¸¸æœ‰æˆå°±æ„Ÿï¼Œæ‰€ä»¥ä¹Ÿä¼šè¶Šå­¦è¶Šæƒ³å­¦ã€‚æ‰“ç ´äº†ä¼ ç»Ÿä¸”éå¸¸ç—›è‹¦çš„è‹±è¯­å­¦ä¹ æ–¹æ¡ˆ
                  â€”â€”èƒŒå•è¯ï¼ˆè¿˜è®°å¾— abandon å—ï¼Ÿ oh ä¸ï¼Œç°åœ¨æ˜¯ aback äº†ï¼‰
                </p>
              </div>
            </div>
          </div>
        </div>
        <div class="w-1/2"></div>
        <div class="w-1/2"></div>
      </section>
      <section class="flex flex-col py-4">
        <div class="mx-auto max-w-screen-xl py-8 sm:px-6 lg:px-8 lg:py-12">
          <h2
            class="text-center text-4xl font-bold tracking-tight sm:text-5xl text-gray-800 dark:text-white mb-4"
          >
            User feedback
          </h2>
          <p class="text-center text-lg mb-6 text-gray-600 dark:text-gray-400">
            If you're using Earthworm, feel free to give us your feedback on
            Twitter.
          </p>
          <div class="mt-8 sm:columns-2 sm:gap-6 lg:columns-3 lg:gap-8">
            <div
              v-for="(item, index) in CommentsList"
              :key="index"
              class="mb-8 sm:break-inside-avoid"
            >
              <blockquote
                class="rounded-lg overflow-hidden shadow-lg transition-all duration-300 hover:shadow-2xl bg-white dark:bg-gray-700 cursor-pointer hover:shadow-purple-500/50 dark:hover:shadow-blue-400/50"
              >
                <div class="flex flex-col justify-between h-full p-6">
                  <div class="flex items-center gap-4">
                    <img
                      :src="item.avatar"
                      alt=""
                      class="h-14 w-14 rounded-full object-cover border-2 border-purple-400 p-1"
                    />
                    <div class="flex-grow">
                      <p
                        class="mt-0.5 text-lg font-bold text-gray-900 dark:text-white"
                      >
                        {{ item.nickname }}
                      </p>
                      <p class="text-xs text-gray-500">
                        {{ "@" + item.account }}
                      </p>
                    </div>
                    <img
                      width="30"
                      :src="item.icon"
                      class="self-start"
                    />
                  </div>
                  <p class="mt-4 text-gray-700 dark:text-gray-300">
                    {{ item.comment }}
                  </p>
                  <div class="flex items-center justify-between my-2">
                    <div class="text-gray-500 text-xs">
                      {{ formatTimestamp({ timestamp: item.time }) }}
                    </div>
                  </div>
                  <div class="mx-auto my-4"></div>
                  <div class="flex items-center justify-between text-xs mt-4">
                    <div class="flex items-center">
                      <svg
                        class="w-5 h-5 mr-2 fill-current text-pink-300 dark:text-blue-300"
                        viewBox="0 0 24 24"
                      >
                        <path
                          d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"
                        />
                      </svg>
                      <span class="text-gray-500 dark:text-gray-400"
                        >{{ item.likeCount }} likes</span
                      >
                    </div>
                    <a
                      :href="item.link"
                      class="text-blue-500 dark:text-blue-400"
                      tabindex="-1"
                      aria-disabled="true"
                      style="pointer-events: none"
                      >See {{ item.account }}'s</a
                    >
                  </div>
                </div>
              </blockquote>
            </div>
          </div>
        </div>
      </section>
    </template>

    <MessageBox
      v-model:is-show-modal="showMobileTip"
      title="å‹æƒ…æç¤º"
      content="ç›®å‰æš‚ä¸æ”¯æŒç§»åŠ¨è®¾å¤‡å“¦ï¼Œè¯·å…³æ³¨åç»­æ›´æ–°~"
      cancel-btn-text="å¥½å“’"
      confirm-btn-text=""
    ></MessageBox>
  </div>
</template>

<script setup lang="ts">
import { onMounted, onUnmounted, ref } from "vue";
import { useRouter } from "vue-router";

import CommentsList from "~/assets/comments.json";
import Loading from "~/components/Loading.vue";
import MessageBox from "~/components/main/MessageBox/MessageBox.vue";
import { formatTimestamp } from "~/utils/date";

import { useGameStore } from "~/store/game";
import { cancelShortcut, registerShortcut } from "~/utils/keyboardShortcuts";

const { handleKeydown, isLoading } = useShortcutToGame();
const gameStore = useGameStore();

const { showMobileTip } = useMonitorSystem();

function useMonitorSystem() {
  const showMobileTip = ref(false);

  function mobileSystem() {
    return "ontouchstart" in document.documentElement;
  }

  onMounted(() => {
    showMobileTip.value = mobileSystem();
  });

  return {
    showMobileTip,
  };
}

function useShortcutToGame() {
  const router = useRouter();
  const isLoading = ref(false);

  async function handleKeydown() {
    isLoading.value = true;
    const { courseId } = await gameStore.startGame();
    isLoading.value = false;
    router.push(`/main/${courseId}`);
  }

  onMounted(() => {
    registerShortcut("enter", handleKeydown);
  });

  onUnmounted(() => {
    cancelShortcut("enter", handleKeydown);
  });

  return {
    handleKeydown,
    isLoading,
  };
}
</script>

<style>
.bg-dot {
  aspect-ratio: 1;
  position: relative;
  background: #fff;
  filter: contrast(50) invert(0);
  mix-blend-mode: multiply;
  isolation: isolate;
  opacity: 0.4;
  overflow: hidden;
}

.dark .bg-dot {
  opacity: 1;
}

.bg-dot::after {
  content: "";
  position: absolute;
  inset: 0;
  background-image: radial-gradient(
    circle at center,
    #a800b2 0.06rem,
    transparent 0.65rem
  );
  background-size: var(--bgSize, 1rem) var(--bgSize, 1rem);
  background-repeat: round;
  background-position:
    0 0,
    var(--bgPosition) var(--bgPosition);
  mask-image: linear-gradient(rgb(0 0 0), rgb(0 0 0 / 0.5));
}

.instruction-btn {
  @apply btn btn-xs text-gray-500 bg-gray-100 hover:text-gray-100 hover:bg-gray-500 dark:text-white dark:bg-gray-500 dark:hover:text-white dark:hover:bg-fuchsia-500;
}
</style>
